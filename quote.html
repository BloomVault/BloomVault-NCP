<!doctype html>
<html lang="en"><head>
  <title>My Cart/Quote Request · BloomVault Farms</title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="assets/css/overrides.css">
</head>
<body>
<div class="wrapper">
  
  <div class="sidebar">
    <div class="brand"><img src="assets/img/logo.png" alt="BloomVault Farms"></div>

    <!-- Gold-styled tabs (shared across site) -->
    <nav class="tabs tabs--gold">
      <a class="tab" href="index.html">Home</a>
      <a class="tab" href="catalogue.html">Cultivar Catalogue</a>
      <a class="tab" href="quote.html">My Cart</a>
      <a class="tab" href="contact.html">Contact Us</a>
    </nav>
  </div>

  <main class="main">
    <section class="card">
      <h1>Your Quote</h1>

      <div class="grid">
        <!-- Cart (left column) -->
        <div class="card cart">
          <h3>Cart</h3>
          <section id="quote-cart"></section>
          <div class="notice" style="margin-top:10px">
            Orders are at a <b>50 plant minimum</b>. Quantities reflect how many times you pressed
            “<b>Add to Quote +1</b>” in the catalogue (1 = 50, 2 = 100, etc.).
          </div>

          <!-- ▼▼ Legal & Compliance block ▼▼ -->
          <hr class="gold-rule" style="margin-top:14px">
          <section class="compliance">
            <h4 class="subhead" style="margin:.25rem 0 .35rem">Legal &amp; Compliance (Virginia)</h4>
            <ul class="compliance-list">
              <li><strong>Eligibility.</strong> We supply plants only to licensed Virginia commercial growers and may request documentation before confirming an order.</li>
              <li><strong>Intended use.</strong> Plants are sold for lawful hemp cultivation. No resale to unlicensed parties; not for home grow or retail.</li>
              <li><strong>Regulatory compliance.</strong> Buyer is responsible for meeting all state and federal requirements (registration, reporting, transport paperwork, and compliance testing).</li>
              <li><strong>THC compliance.</strong> Buyer is responsible for ensuring crops remain within legal THC limits and for any actions required if a lot tests over the limit.</li>
              <li><strong>Transport &amp; records.</strong> We provide invoices/labels; buyer must carry any required documents during transport and maintain records as required by Virginia rules.</li>
              <li><strong>Availability.</strong> Cultivars and timelines depend on propagation success and seasonality. We’ll communicate any changes promptly.</li>
            </ul>
            <p class="small" style="margin-top:.5rem">
              This information is provided for convenience and is not legal advice. By requesting a quote, you acknowledge these requirements and agree to follow all applicable laws.
            </p>
          </section>
          <!-- ▲▲ Legal & Compliance block ▲▲ -->

        </div>

        <!-- Request form (right column) -->
        <div class="card">
          <h3>Request a Quote</h3>
          <form id="quote-form" name="quote" method="POST">
            <!-- Honeypot (off-screen) -->
            <div class="hp" aria-hidden="true" tabindex="-1">
              <label>Don’t fill this out:
                <input type="text" name="bot-field" autocomplete="off">
              </label>
            </div>

            <!-- Time-on-form (ms) -->
            <input type="hidden" name="submit_ms" value="0">

            <div class="form-row">
              <input class="input" name="businessName" placeholder="Legal Business Name*" required>
              <input class="input" name="contactName" placeholder="Contact Name*" required>
            </div>
            <div class="form-row">
              <input class="input" name="email" type="email" placeholder="Email*" required>
              <input class="input" name="phone" placeholder="Phone*" required>
            </div>
            <div class="form-row">
              <input class="input" name="street" placeholder="Business Street Address (Virginia)*" required>
              <input class="input" name="city" placeholder="City*" required>
            </div>
            <div class="form-row">
              <input class="input" name="state" value="VA" required>
              <input class="input" name="zip" placeholder="ZIP*" required>
            </div>
            <div class="form-row">
              <input class="input" name="license" placeholder="VA Hemp License # or 'Pending'*" required>
              <input class="input" name="resale" placeholder="Resale certificate (optional)">
            </div>
            <textarea class="input" name="notes" rows="4" placeholder="Notes (optional)"></textarea>
            <div class="notice" style="margin-top:10px">Currently serving <b>commercial growers in Virginia</b> only.</div>

            <!-- Hidden cart payloads (kept in sync by script) -->
            <input type="hidden" name="cart" value="[]">
            <input type="hidden" name="cart_readable" value="">

            <!-- Human check -->
            <label for="human-check" class="small" style="display:flex;gap:.5rem;align-items:center;margin-top:.6rem">
              <input type="checkbox" id="human-check" name="human_check" value="1" required>
              <span>I am human (no bots)</span>
            </label>

            <button class="btn" type="submit" id="quote-submit" style="margin-top:12px">Request Quote</button>
            <div class="small" id="quote-result" style="margin-top:8px"></div>
          </form>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Optional: keep your modules if used elsewhere -->
<script type="module" src="assets/js/cart.js"></script>
<script type="module" src="assets/js/quote.js"></script>

<!-- Live cart render + hidden fields sync (auto-updates on add/remove and across tabs) -->
<script>
(function () {
  const STORAGE_KEY = "quoteCart";

  function readCart() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
    catch { return []; }
  }
  function writeCart(cart) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
    document.dispatchEvent(new CustomEvent("cart:updated", { detail: { cart } }));
  }

  const cartContainer = document.getElementById("quote-cart");
  const form = document.getElementById("quote-form");
  const hiddenCart = form?.querySelector('input[name="cart"]');
  const hiddenReadable = form?.querySelector('input[name="cart_readable"]');

  function esc(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  function toReadable(cart){
    if (!Array.isArray(cart) || !cart.length) return "";
    return cart.map(it => `${it.name ?? 'Item'} x ${Number(it.qty||1)}`).join(', ');
  }

  function render(cart = readCart()) {
    if (!cartContainer) return;

    // Update hidden fields for submit payloads
    if (hiddenCart) hiddenCart.value = JSON.stringify(cart);
    if (hiddenReadable) hiddenReadable.value = toReadable(cart);

    // Build simple table
    if (!cart.length) {
      cartContainer.innerHTML = '<p class="small">Your quote cart is empty.</p>';
      return;
    }

    const rows = cart.map((it, idx) => {
      const name = esc(it.name ?? 'Item');
      const qty = Number(it.qty || 1);
      const id = esc(String(it.id ?? idx));
      return `
        <tr>
          <td>${name}</td>
          <td class="qty-num">${qty}</td>
          <td style="text-align:right">
            <button class="btn" data-remove="1" data-id="${id}" data-name="${name}" style="padding:.25rem .5rem">Remove -1</button>
          </td>
        </tr>
      `;
    }).join('');

    cartContainer.innerHTML = `
      <table class="table">
        <thead><tr><th>Item</th><th>Qty</th><th></th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }

  // Handle remove -1 on this page only (optional convenience)
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-remove="1"]');
    if (!btn) return;
    e.preventDefault();
    const id = String(btn.dataset.id || "");
    const name = btn.dataset.name || "";
    let cart = readCart();
    const i = cart.findIndex(it => String(it.id) === id && it.name === name);
    if (i >= 0) {
      cart[i].qty = Math.max(0, Number(cart[i].qty||1) - 1);
      if (cart[i].qty === 0) cart.splice(i,1);
      writeCart(cart);  // will also emit cart:updated
      render(cart);
    }
  });

  // Initial paint
  render();

  // Same-tab updates (from assets/js/cart.js add-to-quote clicks)
  document.addEventListener('cart:updated', (e) => render(e.detail?.cart));

  // Cross-tab/window updates
  window.addEventListener('storage', (e) => { if (e.key === STORAGE_KEY) render(); });
})();
</script>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<!-- Anti-spam + EmailJS submit (no redirect) + success reset -->
<script>
/* ... (unchanged JS from your current file) ... */
</script>

</body></html>
