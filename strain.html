<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Strain · BloomVault Farms</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/styles.css" />
  <link rel="stylesheet" href="assets/css/overrides.css" />
  <style>
    .container { max-width: 1000px; margin: 0 auto; padding: 1rem; }
    .detail-wrap { display: grid; gap: 2rem; grid-template-columns: 1fr; }
    .detail-img { width: 100%; height: auto; border-radius: 12px; display: block; }
    .detail-meta { line-height: 1.8 }
    @media (min-width: 800px) { .detail-wrap { grid-template-columns: 1fr 1fr; } }

    /* "+1" bubble (scoped here) */
    .add-to-quote { position: relative; }
    .add-to-quote .plus-one {
      position: absolute; left: 100%; margin-left: 6px; top: 50%;
      transform: translateY(-50%) translateY(6px);
      font-size: 12px; font-weight: 700; opacity: 0; pointer-events: none;
      background: linear-gradient(#caa95a,#b58c2b); color:#111; border:1px solid #8b6b18;
      padding: 2px 6px; border-radius: 9999px; white-space: nowrap;
      animation: popFade .8s ease-out forwards;
      box-shadow: 0 1px 2px rgba(0,0,0,.25);
    }
    @keyframes popFade {
      0%   { opacity: 0; transform: translateY(-50%) translateY(6px) scale(.9); }
      20%  { opacity: 1; transform: translateY(-50%) translateY(-2px) scale(1); }
      100% { opacity: 0; transform: translateY(-50%) translateY(-12px) scale(1); }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="sidebar">
      <div class="brand"><img src="assets/img/logo.png" alt="BloomVault Farms" /></div>

      <!-- Luxe gold nav + live cart badge -->
      <nav class="tabs tabs--gold">
        <a class="tab" href="index.html">Home</a>
        <a class="tab" href="catalogue.html">Cultivar Catalogue</a>
        <a class="tab" href="quote.html">My Cart <span class="nav-badge" id="cart-count" hidden>0</span></a>
        <a class="tab" href="contact.html">Contact Us</a>
      </nav>
      <!-- (Serving VA only tag removed sitewide) -->
    </div>

    <main class="main">
      <div id="strain-main" class="container">
        <article id="strain-detail"><noscript>This page needs JavaScript enabled.</noscript></article>
      </div>
    </main>
  </div>

  <script>
  (function () {
    try {
      const el = document.getElementById("strain-detail");
      if (!el) return;

      const FALLBACK_IMG = "assets/img/strain-placeholder.svg";
      const id = (new URLSearchParams(location.search).get("id") || "1").trim();

      // -------- Data --------
      const STRAINS = {
        "1": {
          name: "Sticky Icky",
          image: "assets/img/sticky-icky.jpg",
          type: "Hybrid",
          flowering: "—",
          yield: "—",
          terpenes: "—",
          desc: "Gorilla Glue #4 × Animal Cookies."
        }
        // Add more entries keyed by id if needed
      };

      const data = STRAINS[id];
      if (!data) {
        el.innerHTML = '<h1>Strain not found</h1><p><a href="catalogue.html">Back to catalogue</a></p>';
        return;
      }

      const imgSrc = (data.image && data.image.trim()) ? data.image : FALLBACK_IMG;

      // -------- Render --------
      el.innerHTML = `
        <div class="detail-wrap">
          <img class="detail-img" src="${imgSrc}" alt="${data.name}"
               onerror="this.src='${FALLBACK_IMG}'" loading="lazy">
          <div>
            <h1 class="heading-brand" style="margin:0 0 .5rem">${data.name}</h1>
            <p>${data.desc}</p>
            <ul class="detail-meta">
              <li><strong>Type:</strong> ${data.type}</li>
              <li><strong>Flowering:</strong> ${data.flowering}</li>
              <li><strong>Yield:</strong> ${data.yield}</li>
              <li><strong>Terpenes:</strong> ${data.terpenes}</li>
            </ul>
            <div class="actions" style="margin-top:.75rem">
              <button type="button" class="btn add-to-quote"
                      data-id="${id}" data-name="${data.name}">
                Add to Quote +1
              </button>
            </div>
            <p class="small" style="margin-top:.5rem"><a href="catalogue.html">← Back to catalogue</a></p>
          </div>
        </div>
      `;

      // -------- Cart helpers --------
      const STORAGE_KEY = "quoteCart";
      function readCart() {
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
        catch (e) { return []; }
      }
      function writeCart(cart) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
        // keep sidebar badge in sync (use global helper if present)
        if (window.bvUpdateCartBadge) window.bvUpdateCartBadge();
      }
      function addOne(itemId, name) {
        let cart = readCart();
        const i = cart.findIndex(it => String(it.id) === String(itemId) && it.name === name);
        if (i >= 0) cart[i].qty = (cart[i].qty || 0) + 1;
        else cart.push({ id: String(itemId), name, qty: 1 });
        writeCart(cart);
      }
      function plusOneBubble(btn) {
        const b = document.createElement("span");
        b.className = "plus-one";
        b.textContent = "+1";
        btn.appendChild(b);
        setTimeout(() => b.remove(), 850);
      }

      // -------- Local badge fallback (if global not loaded) --------
      const badge = document.getElementById('cart-count');
      function totalQty(items){ return items.reduce((n,it)=> n + (it.qty || 0), 0); }
      function updateBadgeLocal(){
        if(!badge) return;
        const q = totalQty(readCart());
        badge.textContent = q;
        badge.hidden = (q <= 0);
      }

      // -------- Wire button (no redirect) --------
      const btn = el.querySelector(".add-to-quote");
      if (btn) {
        btn.addEventListener("click", function () {
          addOne(this.dataset.id, this.dataset.name);
          plusOneBubble(this);
          // Update badge (global helper first, fallback otherwise)
          if (window.bvUpdateCartBadge) window.bvUpdateCartBadge(); else updateBadgeLocal();
          if (window.showToast) showToast(`Added “${this.dataset.name}” +1`);
          // Cross-tab sync
          window.dispatchEvent(new Event('storage'));
        });
      }

      // Init badge + active tab
      if (window.bvUpdateCartBadge) window.bvUpdateCartBadge(); else updateBadgeLocal();
      window.addEventListener('storage', () => { if (window.bvUpdateCartBadge) window.bvUpdateCartBadge(); else updateBadgeLocal(); });
      window.addEventListener('focus',  () => { if (window.bvUpdateCartBadge) window.bvUpdateCartBadge(); else updateBadgeLocal(); });

      const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
      document.querySelectorAll('.tabs a').forEach(a=>{
        const href = (a.getAttribute('href') || '').toLowerCase();
        if (href.endsWith(here)) a.setAttribute('aria-current','page');
      });

    } catch (e) {
      (document.getElementById("strain-detail") || document.body)
        .innerHTML = '<div style="background:#fee;color:#900;padding:1rem;border-radius:8px">Error rendering details.</div>';
      console.error(e);
    }
  })();
  </script>
</body>
</html>
